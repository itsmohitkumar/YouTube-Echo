name: CI

on:
  push:
    branches: 
      - main  # Trigger the workflow on push to the main branch

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    
      # Step 1: Checkout the code from the repository
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 2: Verify Secrets
      - name: Verify Secrets
        run: |
          echo "üîç Verifying Secrets..."
          if [[ -z "${{ secrets.DOCKERHUB_USERNAME }}" ]]; then
            echo "‚ùå DOCKERHUB_USERNAME is not set"
          else
            echo "‚úÖ DOCKERHUB_USERNAME is set"
          fi

          if [[ -z "${{ secrets.DOCKER_PASSWORD }}" ]]; then
            echo "‚ùå DOCKER_PASSWORD is not set"
          else
            echo "‚úÖ DOCKER_PASSWORD is set"
          fi

      # Step 3: Log in to Docker Hub
      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}  # Your Docker Hub username
          password: ${{ secrets.DOCKER_PASSWORD }}      # Your Docker Hub password

      # Step 4: Build the Docker image
      - name: Build the Docker image
        run: |
          echo "üî® Building the Docker image..."
          docker build -t ${{ secrets.DOCKERHUB_USERNAME }}/your-image-name:latest .
          echo "‚úîÔ∏è Docker image built successfully"

      # Step 5: Push the Docker image to Docker Hub
      - name: Push the Docker image
        run: |
          echo "üöÄ Pushing the Docker image to Docker Hub..."
          docker push ${{ secrets.DOCKERHUB_USERNAME }}/your-image-name:latest
          echo "‚úîÔ∏è Docker image pushed successfully"

      # Step 6: (Optional) Run the Docker container (if needed)
      - name: Run the Docker container
        run: |
          echo "üõ†Ô∏è Running the Docker container..."
          docker run -d -p 5000:5000 \
            --name your-container-name \
            ${{ secrets.DOCKERHUB_USERNAME }}/your-image-name:latest
          echo "‚úîÔ∏è Docker container is running"
